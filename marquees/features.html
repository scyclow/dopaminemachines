
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

    <script>
      function genTokenData(projectNum) {
        const qp = window.location.search
          ? window.location.search.replace('?', '').split('&').reduce((params, i) => {
              const [k, v] = i.split('=')
              params[k] = v
              return params
            }, {})
          : {}

        const tokenId = String(projectNum * 1000000 + Math.floor(Math.random() * 1000))
        let hash = '0x'
        if (qp.hash) {
          hash = qp.hash
        } else {
          for (let i = 0; i < 64; i++) {
            hash += Math.floor(Math.random() * 16).toString(16)
          }
          window.location.hash = '#' + hash

          const last10hashes = JSON.parse(localStorage.getItem('last10Hashes')) || []
          last10hashes.unshift(hash)

          localStorage.setItem('last10Hashes', JSON.stringify(last10hashes.slice(0, 10)))
        }
        return {
          hash,
          // hash: '0xfeff8806ffe0ff004900b6104392c062d40f238839029c82ed000ffff3cb2003',
          tokenId
        }
      }

      const tokenData = genTokenData(999)
      console.log(tokenData.hash)

      function LOAD_LAST(i=1) {
        const hashes = JSON.parse(localStorage.getItem('last10Hashes'))
        const hash = hashes[i]
        const newLocation = window.location.href.replace(/(\#|\?).*/, '') + '?hash=' + hash
        window.location.href = newLocation
      }
    </script>

</head>

<script src="https://unpkg.com/twemoji@latest/dist/twemoji.min.js" crossorigin="anonymous"></script>



<script src="./utils.js"></script>
<script src="./mock$.js"></script>
<script src="./globals.js"></script>
<script src="./sound.js"></script>
<script src="./components.js"></script>
<script src="./text.js"></script>
<script src="./sections.js"></script>
<script type="text/javascript">
  function calculateFeatures(tokenData) {
    // ...
    const main = $.main(
      flexSection(rows, cols),
      {
        id: 'main',
        style: `
          height: 100vh;
          width: 100vw;
          overflow: hidden;
          display: grid;
          grid-template-rows: repeat(${rows}, 1fr);
          grid-template-columns: repeat(${cols}, 1fr);
        `
      }
    )

    const usedContent = Array.from(
      new Set(
        Array.from(main.getElementsByClassName('content')).map(e => e.innerHTML)
      )
    )

    const features = [...emojiList, ...textLists.flat()].reduce((f, t) => {
      f[t] = false
      return f
    }, {})

    usedContent.forEach(c => features[c] = true)

    // features['Layout Type'] = layoutStyle
    // features['Background Type'] = hideBg ? 'none' : bgType
    // features['Shadow Type'] = shadowType
    // features['Font'] = fontFamily
    // features['Borders'] = showBorder ? borderStyle : 'none'
    // features['Askew'] = freeFloating
    // features['Hues'] = randomHue ? '???' : possibleHues.length
    // features['Inverted'] = invertAll
    // features['Random Calls'] = rCount
    // features['Sections'] = sectionCount

    return features
  }

  const f = calculateFeatures(tokenData)
  console.log(f)
</script>

<body>

</body>
</html>