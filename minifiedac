justCharLength(n.innerHTML,i)/9,l=t/e,m=prb(thinSidewaysPrb)&&l<.333||prb(sidewaysPrb)&&l>=.3333&&l<1.2,c=chooseHue(),d=chooseAltHue(c),u=e>=2&&t/e>=5,p=n.innerHTML.length<8,h=prb(marqueeAnimationRate)&&u?chance([1,growShrinkShort],[1,vSirenShort],[1,blink],...p?[[1,dance],[1,spin],[1,hSiren],[1,hPivot],[1,hFlip]]:[]):iden,g=rnd(750,1500),S=rnd(map(m?t/cols:e/rows,0,1,.5,20),100)*s*speed,f=S/5+rnd(S/5),E=t/e>=6&&prb(.1),A=E&&prb(.5),T=elementIsEmoji(n),y=$.span(n.cloneNode(!0),{class:T?"emojiShadow":"",style:getShadow(d,!T),"data-h":d}),b=i?[y,$.span(i,{class:"emojiShadow",style:`margin-left: 1em; ${getShadow(d,!1)}`,"data-h":d})]:y,w={duration:g*s*speed/2,delay:f,showTrails:A};let L,O;E?(L=leftRight(b,{style:`font-size: ${r};`,duration:g*s*speed,delay:f,showTrails:A}),O=zoomSound({...w,switchChannels:!0})):(L=marquee(b,{style:`font-size: ${m?a:r};`,direction:posOrNeg(),delay:f,duration:S,sideways:m,msgAnimation:h}),h!==iden&&(O=createSound(h,{duration:2e3},!0)));let I=[],C=!1;const R=prb(.1);return sectionContainer(L,e,t,c,d,()=>{if(E){if(I.length)return I.forEach(e=>e()),void(I=[]);const e=O();if(R||I.push(e),A){const e=R?zoomSound({...w,switchChannels:!0})(20):O(20);R||I.push(e)}}else if(C?(stopUtter(n.innerHTML),C=!1):(utter(n.innerHTML,30,7),C=!0),I.length)I.forEach(e=>e()),I=[];else if(O){const e=O();R||I.push(e)}})}function getFontSize(e,t,n){const o=t/rows,i=n/cols,r=e.split(" "),a=r.reduce((e,t)=>adjustCharLength(t)>adjustCharLength(e)?t:e,r[0]),s=adjustCharLength(a);return`calc(min(${o/(adjustCharLength(e)/s)} * 100vh, ${i/s} * 100vw))`}const allPlayingSounds=[];let animationCount=0;function animationContainer(e,t){animationCount++;let[n,o]=sampleContent();textOverride&&(n=o);const i=chooseHue(),r=chooseAltHue(i),a=[...emojiList,"<<<<",">>>>"].includes(n.innerHTML.replace("!","")),s=sample([dance,growShrink,spin,hSiren,vSiren,hPivot,vPivot,vFlip,hFlip,updownLong,climb,blink,hexagon,flamingHot,iden,prb(.5)&&breathe,!a&&updownChars,!a&&blinkChars,!a&&shrinkChars].filter(iden)),l=n.innerHTML.split(" "),m=l.reduce((e,t)=>t.length<e.length?t:e,l[0]),c=(n.innerHTML.length,m.length,getFontSize(n.innerHTML,e,t)),d=s===updownLong||prb(.75)?iden:sample([dance,growShrink,spin,hSiren,vSiren,hPivot,vPivot,vFlip,hFlip,climb]),u={delay:rnd(3500),duration:rnd(750,5e3),direction:prb(.5)?1:-1,showTrails:prb(.2)},p={delay:rnd(3500),duration:rnd(750,5e3),showTrails:u.showTrails},h=$.div(d(s(n.cloneNode(!0),u),p),{class:"animationContainer"+(a?" emojiShadow":""),"data-h":i,style:` height: ${100*e/rows}vh; font-size: ${c}; ${getShadow(r,!a)} text-align: center; display: flex; align-items: center; justify-content: center; `});let g=[];const S=prb(.1),f=createSound(s,u),E=d!==iden?createSound(d,p):null;return sectionContainer(h,e,t,i,r,()=>{if(g.length)return g.forEach(e=>e()),void(g=[]);const e=f();if(S||g.push(e),u.showTrails&&s!==blinkChars){const e=S?createSound(s,u)(10):f(10);S||g.push(e)}if(E){const e=E();S||g.push(e)}})}function getEmojiGrid(e,t){const n=rndint(1,min(e/2,t/2));return[max(1,int(e/n)),max(1,int(t/n))]}let gridCount=0;function animationGridContainer(e,t){const n=sample(_content.emojis);if(!n)return animationContainer(e,t);gridCount++;const o=chooseHue(),i=chooseAltHue(o),r=chance([5,growShrink],[4,spin],[3,blink],[3,vSiren],[3,hSiren],[3,vFlip],[3,hFlip],[1,dance],[1,wave],[1,climb]),[a,s]=getEmojiGrid(e,t),l=rnd(750,5e3),m=rnd(.5,2),c=$.div(times(a*s,e=>r(n.cloneNode(!0),{delay:e/(a*s)*l*m,duration:l})),{class:"animationGridContainer emojiShadow","data-h":o,style:` font-size: ${100*min(e/(a*rows),t/(s*cols*1.2))}vmin; height: ${100*e/rows}vh; width: ${100*t/cols}vw; display: grid; align-items: center; justify-items: center; grid-template-rows: repeat(${a}, 1fr); grid-template-columns: repeat(${s}, 1fr); ${getShadow(i,!1)} `}),d={delay:l*m,duration:l};let u=[];const p=prb(.1),h=createSound(r,d,!0);return sectionContainer(c,e,t,o,i,()=>{if(u.length)return u.forEach(e=>e()),void(u=[]);const e=h();if(p||u.push(e),r!==blink){const e=p?createSound(r,d)(l/4):h(l/4);p||u.push(e)}})}function flexSection(e,t){const n={};times(e,e=>n[e]=[]);const o=[];let i,r,a,s;if([1,2].includes(layoutStyle))i=1,a=1,r=t,s=e;else if(3===layoutStyle)i=1,a=1,r=t,s=int(e/8);else if(4===layoutStyle)prb(.5)?(i=t*(5/12),a=e*(5/12)):(i=t,a=e),r=t,s=e;else if(5===layoutStyle){const e=sample([1,2,3,4,6,8,12,16,24]);a=e,s=e,i=12,r=t}else if(6===layoutStyle){const t=sample([2,3,4,6,10,15]);i=t,r=t,a=prb(.5)?16:e,s=e}else if(7===layoutStyle){const e=sample([3,4,6,12,16]);i=e,r=e,a=e,s=e}else if(8===layoutStyle)i=1,a=1,r=int(t/6),s=int(e/6);else if(9===layoutStyle){const n=rndint(1,7);i=n,a=n,r=t,s=e}const l=(e,o)=>{for(let i=o;i<t;i++)if(!n[e][i])return i;return t},m=(e,t,n)=>{const o=rndint(min(e,t),n);return t-o<e?t:o},c=(l,c)=>{let d=s,u=r;1!==layoutStyle||sectionCount?2===layoutStyle&&prb(.9)?prb(.2)?u=sample([1,2]):d=sample([1,2]):9===layoutStyle&&(prb(.3)?u=rndint(1,7):d=rndint(1,7)):(prb(.5)&&(d=e/4),prb(.5)&&(u=t/4));const p=min(((e,o)=>{for(let i=o;i<t;i++)if(n[e][i])return i;return t})(l,c)-c,u),h=max(1,min(e-l,d)),g=m(i,p,t),S=m(a,h,e),f=g/S;return o.push(f<1.25&&f>.8?prb(.75)&&_content.emojis.length?animationGridContainer(S,g):animationContainer(S,g):f<2&&f>.5&&prb(.5)?animationContainer(S,g):marqueeContainter(S,g)),times(S,e=>times(g,t=>n[l+e][c+t]=1)),{cSpan:g,rSpan:S}};let d=0;for(;d<e;){let e=l(d,0);for(;e<t;){const{cSpan:t}=c(d,e);e=l(d,e+t)}d++}return $.section(o,{style:` width: ${100*t/cols}vw; height: ${100*e/rows}vh; overflow: hidden; grid-row: span ${e}; grid-column: span ${t}; display: grid; grid-template-rows: repeat(${e}, 1fr); grid-template-columns: repeat(${t}, 1fr); `})}const main=$.main(flexSection(rows,cols),{id:"main",style:` height: 100vh; width: 100vw; overflow: hidden; display: grid; grid-template-rows: repeat(${rows}, 1fr); grid-template-columns: repeat(${cols}, 1fr); `}),usedContent=Array.from(new Set([...$.cls(main,"content").map(e=>e.innerHTML),...$.cls(main,"charContentGroup").map(getContent)]));window.onload=(()=>{document.body.innerHTML="",setMetadata(usedContent.join(" ")),$.render(document.body,main),PAUSED&&(LAST_PAUSED=Date.now(),document.body.classList.add("pauseAll"));let e=USE_EMOJI_POLYFILL,t=!1,n=!1;document.onkeydown=(o=>{if("d"===o.key){const e=document.createElement("a");e.href="data:text/html;charset=UTF-8,"+encodeURIComponent(document.documentElement.outerHTML),e.download=usedContent.join(" ").replaceAll(" ","-")+".html",document.body.appendChild(e),e.click(),document.body.removeChild(e)}else if("o"===o.key)OVERDRIVE?(document.body.classList.remove("overdrive"),allRunningIntervals.forEach(e=>{e.newInterval(e.originalMs)})):(document.body.classList.add("overdrive"),allRunningIntervals.forEach(e=>{e.newInterval(e.originalMs/6)})),OVERDRIVE=!OVERDRIVE;else if("p"===o.key){PAUSED?(START_TIME+=Date.now()-LAST_PAUSED,document.body.classList.remove("pauseAll")):(LAST_PAUSED=Date.now(),document.body.classList.add("pauseAll")),PAUSED=!PAUSED;try{window.localStorage.setItem("__DOPAMINE_IS_PAUSED__",PAUSED)}catch(e){}}else if("a"===o.key)ANHEDONIC?(document.body.classList.remove("anhedonic"),sourcesToNormalMode()):(document.body.classList.add("anhedonic"),sourcesToAnhedonicMode()),ANHEDONIC=!ANHEDONIC;else if("m"===o.key)n?(document.exitPointerLock(),document.body.classList.remove("viewerMode")):(document.body.classList.add("viewerMode"),document.body.requestPointerLock()),n=!n;else if("i"===o.key)INVERT_ALL?document.body.classList.remove("invertAll"):document.body.classList.add("invertAll"),INVERT_ALL=!INVERT_ALL;else if("n"===o.key)t?document.exitFullscreen():document.body.requestFullscreen({navigationUI:"hide"}),t=!t;else if("e"===o.key){const t=$.cls(document,"emojiShadow");e?(Array.from(document.getElementsByTagName("img")).forEach(e=>{e.replaceWith(e.alt)}),t.forEach(e=>{e.style.textShadow=getTextShadowValue(Number(e.dataset.h)||0),e.style.filter=""})):window.twemoji&&(twemoji.parse(document.body,{folder:"svg",ext:".svg",className:"emojiPolyfill"}),t.forEach(e=>{e.style.filter=getDropShadowValue(Number(e.dataset.h)||0),e.style.textShadow=""})),e=!e;try{window.localStorage.setItem("__DOPAMINE_EMOJI_TOGGLE__",e)}catch(e){}}}),USE_EMOJI_POLYFILL&&window.twemoji&&twemoji.parse(document.body,{folder:"svg",ext:".svg",className:"emojiPolyfill"})});